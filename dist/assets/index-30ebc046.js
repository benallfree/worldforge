let e,t,o,a=Object,n=a.getPrototypeOf,s=document,r=(e,t,o,a)=>(e??(setTimeout(o,a),new Set)).add(t),i={get val(){return this.t},set val(e){let o=this,a=o.t;if(e!==a){o.o===a?t=r(t,o,f):e===o.o&&t.delete(o),o.t=e;for(let t of o.l)t(e,a)}},onnew(e){this.l.push(e)}},l=n(i),c=e=>n(e??0)===i,d=e=>c(e)?e.t:e,u=e=>e.map(d),p=e=>e.nodeType?e:new Text(e),h=(t,...o)=>{for(let a of o.flat(1/0))d(a)!=e&&t.appendChild(n(a)===i?y(a,(e=>e)):p(a));return t},m={},v=t=>new Proxy(((o,...r)=>{var c;let[d,...u]=n(r[0]??0)===l?r:[{},...r],p=t?s.createElementNS(t,o):s.createElement(o);for(let[t,s]of a.entries(d)){let r=o=>o?a.getOwnPropertyDescriptor(o,t)??r(n(o)):e,d=o+","+t,u=m[d]??(m[d]=(null==(c=r(n(p)))?void 0:c.set)??0)?e=>p[t]=e:e=>p.setAttribute(t,e);n(s)===i?y(s,(e=>(u(e),p))):n(s)===l?y(...s.deps,((...e)=>(u(s.f(...e)),p))):u(s)}return h(p,...u)}),{get:(t,o)=>t.bind(e,o)}),g=e=>e.i=e.i.filter((e=>{var t;return null==(t=e.u)?void 0:t.isConnected})),f=()=>{let o=[...t];t=e;for(let t of new Set(o.flatMap(g))){let{_:o,u:n}=t,s=t.g(...u(o),n,...(a=o,a.map((e=>c(e)?e.o:e))));s!==n&&(s!=e?n.replaceWith(t.u=p(s)):(n.remove(),t.u=e))}var a;for(let e of o)e.o=e.t},y=(...t)=>{let a=t.pop(),n=a(...u(t));if(n!=e){let s={_:t,u:p(n),g:a};for(let a of t)c(a)&&(o=r(o,a,(()=>(o.forEach(g),o=e)),1e3),a.i.push(s));return s.u}};const w={add:h,tags:v(),tagsNS:v,state:e=>({__proto__:i,t:e,o:e,i:[],l:[]}),bind:y},{button:C,div:b,a:A,p:I,pre:k,br:E,input:$,img:x,sup:S,h1:D,h2:T,textarea:M}=w.tags,{state:O,bind:P}=w,R=e=>e,B="",F="#00000000",L="#00FF00",N="wfdlc",W=16;let _=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"");const U=e=>e,j=()=>_(),J=e=>"id"in e&&"code"in e&&"sprite"in e,H="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",z=()=>({id:j(),name:"New Asset",description:"",code:"",isBedrock:!1,sprite:H,spriteData:{highestFrameCount:1,animations:[{reverseLoop:!1,frameCount:1}]}}),G=e=>({...e}),X=e=>({...{...z(),...e}}),Y=e=>e,q=e=>{const t={assets:[],...e},{assets:o}=t;return{assets:o}};function Q(e){const t=e.toString(16);return 1===t.length?"0"+t:t}const V=e=>({alpha:parseInt(e.slice(7,9),16),red:parseInt(e.slice(1,3),16),green:parseInt(e.slice(3,5),16),blue:parseInt(e.slice(5,7),16)}),K=(e,t,o)=>`rgb(${e}, ${t}, ${o})`,Z=(e,t=0)=>({red:e[t],green:e[t+1],blue:e[t+2],alpha:e[t+3]}),ee=(e,t,o,a)=>`#${Q(e)}${Q(t)}${Q(o)}${Q(a)}`,te=e=>e.slice(0,7),oe=(e,t)=>`${e}${Q(t)}`,ae=e=>e,ne=e=>e,se=100,re=e=>{if(e<0||e>se)throw new Error(`Grid size ${e} out of range`);return e},ie=(e,t)=>`${e}:${t}`,le=50,ce=re(20);function de(e){if(!e)throw new Error("Assertion failure")}const ue=e=>JSON.parse(JSON.stringify(e));async function pe(e){const t=(new TextEncoder).encode(e),o=new CompressionStream("deflate"),a=o.writable.getWriter();a.write(t),a.close();const n=await new Response(o.readable).arrayBuffer(),s=new Uint8Array(n),r=String.fromCharCode.apply(null,s);return encodeURIComponent(btoa(r))}function he(e){const t=atob(decodeURIComponent(e)),o=new Uint8Array(t.length);for(let s=0;s<t.length;s++)o[s]=t.charCodeAt(s);const a=new DecompressionStream("deflate"),n=a.writable.getWriter();return n.write(o),n.close(),new Response(a.readable).arrayBuffer().then((function(e){return(new TextDecoder).decode(e)}))}const me=(e,t,o)=>{const a=document.getElementById(e);if(a&&!o)return;a&&o&&a.remove();const n=document.createElement("style");n.type="text/css",n.id=e,n.appendChild(document.createTextNode(t)),document.head.appendChild(n)};function ve(e){let t=ge(e);return Array.isArray(e)&&(t=t.filter((e=>"length"!==e))),t}function ge(e){return e?Object.getOwnPropertyNames(e):[]}const fe="tile",ye="layer",we="interactive",Ce="container",be="clearfix",Ae="no-select",Ie="pulsing",ke="danger",Ee="success",$e=(...e)=>({class:e.map((e=>Array.isArray(e)?e.join(" "):e)).join(" ")}),xe=(e,t)=>Te("onclick",e,t),Se=(e,t)=>Te("onmousemove",e,t),De=(e,t)=>Te("onmousedown",e,t),Te=(e,t,o)=>{const{targetOnly:a}={targetOnly:!1,...o};return{[e]:function(e){a&&e.target!==this||(e.stopPropagation(),null==t||t(e))}}},Me="WFDLC*",Oe=e=>pe(e).then((e=>`${Me}${e}`)),Pe=async e=>{const[,t]=e.match(/WFDLC\*(.+)/)||[];if(t)return he(t)},Re=e=>Oe(e).then((e=>`${document.location.origin}?${N}=${e}`)),Be=()=>new Promise((e=>setTimeout(e))),Fe=e=>(e.addEventListener("contextmenu",(function(e){e.preventDefault()})),e),Le=e=>Object.entries(e),Ne=e=>`${e}px`,We=e=>new URLSearchParams(window.location.search).get(e),_e=()=>We(N),Ue=()=>!!_e(),je=e=>[...Array(e)].map(((e,t)=>t)),Je=e=>eval(`(${e})`),He=e=>{try{return Je(e),""}catch(t){return`${t.message}`}};function ze(e){return Array.from(new Set(e))}const Ge=e=>{const{title:t,selected:o,onClick:a,extraProps:n,unstyled:s}={unstyled:!1,selected:!1,onClick:()=>{},...e},r={...n,...$e("ToolButton",we,o?"selected":"",s?"unstyled":"")};return C({...r,...xe(a)},t())},Xe=e=>{const{floating:t,tools:o,onToolItemClicked:a,activeItemIdx:n,title:s}={activeItemIdx:0,floating:!1,tools:[],title:"",onToolItemClicked:e=>{r.val=e},...e},r=O(n);return b({...$e("Toolbar",t?"floating":"",s?"with-title":"")},b({...$e("toolbar-title")},s),P(r,(e=>b({...$e()},...o.map(((t,o)=>Ge({selected:e===o,onClick:()=>a(o),...t})))))))},Ye={tabs:{}},qe=e=>{const{tabs:t}={...Ye,...e},o=Le(t);de(o.length>0);const a=O(0);return P(a,(e=>b({...$e("TabManager")},Xe({tools:o.map((([t],o)=>({title:()=>t,selected:e===o}))),onToolItemClicked:e=>{a.val=e}}),o[e][1]())))},Qe={},Ve=e=>{const{assetEditor:t}=po,{selectAnimationFrame:o,xOffset:a,yOffset:n,removeFrame:s,addFrame:r,toggleReverseLoop:i,spriteData:l}=t();return P(a,n,l,((e,t,a)=>1===a.animations.length&&1===a.highestFrameCount?b():b(...a.animations.map(((a,n)=>b(Xe({title:`Animation ${n}`,tools:[...je(a.frameCount).map(((a,s)=>({title:()=>s,selected:e===s&&t===n,onClick:()=>o(s,n)}))),{title:()=>"ðŸ”„",selected:a.reverseLoop,onClick:()=>{i(n)}}]})))))))},Ke=e=>{const{assetEditor:t}=po,{palette:o,setSelectedColor:a}=t();return P(o,(e=>b({...$e("CustomPalette",be)},...e.map((e=>b({...$e("color"),style:`background-color: ${e}`,...xe((()=>{a(e)}))})))||[])))},Ze=e=>{const{assetEditor:t}=po,{rgbHexPixels:o,setPixel:a}=t(),n=(e,t)=>{if(!(e instanceof PointerEvent||e.buttons))return;const o=Math.floor(t/W);a(t%W,o)},s=b({...$e("PixelEditor")},...o.map(((e,t)=>b({...$e("pixel",we),style:{deps:[e],f:e=>`background-color: ${e}`},...Se((e=>n(e,t))),...De((e=>n(e,t)))}))));return Fe(s)},et={},tt=e=>b(Ze(),Ke()),ot={asset:z(),row:0,frame:0,isAnimating:!1,gc:!1,extraClasses:[]},at=(e,t,o)=>{const{id:a,spriteData:n}=e,{frameCount:s}=n.animations[t],r=`sprite_${a}_${t}`;return me(r,`@keyframes ${r} {\n    from {\n      background-position: 0px ${-t*le}px;\n    }\n    to {\n      background-position: ${-s*le}px ${-t*le}px;\n    }\n  }`,o),r},nt=(e,t)=>{const{id:o,sprite:a,spriteData:{highestFrameCount:n}}=e,s=`sprite_${o}`;return me(s,`.${s} {\n      background-size: ${W*n*(le/W)}px;\n      background-image: url(${a});\n      `,t),s},st=e=>{const{asset:t,row:o,frame:a,isAnimating:n,gc:s,extraClasses:r}={...ot,...e},i=t.spriteData.animations[o].reverseLoop,l=nt(t,s),c=at(t,o,s),d=b({...$e("SpriteRenderer",l,...r)});return d.style.backgroundPositionX=-a*le+"px",d.style.backgroundPositionY=-o*le+"px",d.style.animation=n?`${c} 1s steps(${t.spriteData.animations[o].frameCount}) infinite ${i?"alternate":""}`:"none",d},rt=e=>{const{background:t}=e,{assetEditor:o}=po,{xOffset:a,yOffset:n,isPlaying:s,asset:r,spriteData:i,sprite:l}=o();return b({...$e("Preview",be),style:`background-color: ${t}`},...je(9).map((()=>b({...$e("preview-cell",fe)},b({...$e("border-overlay",fe,ye)}),b({...$e(fe,ye)},P(a,n,s,i,l,((e,t,o)=>st({asset:r(),row:t,frame:e,isAnimating:o,gc:!0}))))))))},it={},lt=e=>{const{assetEditor:t}=po,{spriteData:o,sprite:a,canvas:n}=t();return b(qe({tabs:{Tile:()=>b(rt({background:"black"}),rt({background:"white"})),Sprite:()=>b(P(a,o,((e,t)=>x({src:e,style:`width: 100%; max-width: ${le*t.highestFrameCount}px`}))))}}),n)};var ct=(e=>(e[e.Draw=0]="Draw",e[e.Erase=1]="Erase",e))(ct||{});const dt=e=>{const{assetEditor:t}=po,{setSelectedColor:o,color:a}=t();function n(){o(this.value)}return P(a,(e=>$({type:"color",style:"border-radius: 8px;",value:e,onchange:n})))},ut={},pt=e=>{const{assetEditor:t}=po,{tool:o,addAnimation:a,isPlaying:n,togglePlay:s,copy:r,hasCopy:i,paste:l,setTool:c,addFrame:d,removeFrame:u,yOffset:p}=t();return P(o,(e=>b(Xe({title:"Paint",tools:[{title:()=>"âœï¸",onClick:()=>{c(ct.Draw)},selected:e===ct.Draw},{title:()=>"ðŸ§¹",onClick:()=>{c(ct.Erase)},selected:e===ct.Erase},{title:()=>dt(),onClick:()=>{},unstyled:!0,selected:!1},{title:()=>b("copy"),onClick:()=>{r()}},{title:()=>b("paste"),extraProps:{disabled:{deps:[i],f:e=>!e}},onClick:()=>{l()}}]}),Xe({title:"Animate",tools:[{title:()=>"ðŸ’«",onClick:()=>{a()},unstyled:!0,selected:!1},{title:()=>b(P(n,(e=>e?"â¹ï¸":"â–¶ï¸"))),onClick:()=>{s()}},{title:()=>"+ðŸ–¼ï¸",onClick:()=>{d(p.val)}},{title:()=>"-ðŸ–¼ï¸",onClick:()=>{u(p.val)}}]}))))},ht=()=>b({...$e("Canvas")},pt(),Ve(),b({...$e("grid-container")},tt(),lt())),mt={},vt=e=>{const{assetEditor:t}=po,{code:o,setCode:a}=t();return P(o,(e=>{const t=O(He(e));return b({...$e("CodeEditor")},I("Write your custom code here."),P(t,(e=>e?I({class:"danger"},`Syntax error: ${e}`):b())),M({oninput:function(){a(this.value),t.val=He(this.value)}},e))}))},gt={},ft=e=>{const{assetEditor:t}=po,{isBedrock:o,setIsBedrock:a}=t();return P(o,(e=>b({...$e("BedrockEditor")},C({...$e(e?"selected":""),...xe((()=>{a(!e)}))},"Bedrock"))))},yt={},wt=e=>{const{assetEditor:t}=po,{description:o,setDescription:a}=t();return b({...$e("DescriptionEditor")},P(o,(e=>M({onchange:function(){a(this.value)}},e))))},Ct={},bt=(e,...t)=>{const{assetEditor:o}=po,{name:a,setName:n}=o();return P(a,(e=>b({...$e("TitleEditor")},$({type:"text",value:e,onchange:function(){n(this.value)}}))))},At={},It=e=>b({...$e("Meta")},I("Title"),bt(),I("Description"),wt(),I("Bedrock"),ft()),kt=e=>{const{content:t,success:o,instructions:a}={success:"Copied to clipboard!",instructions:"Copy (CTRL+C / CMD+C) or use the copy button below.",...e},n=O(!1),s=M({readonly:!0},t);return b(I(a),s,b(C({...xe((()=>{s.select(),document.execCommand("copy"),n.val=!0}))},"ðŸ“‹"),P(n,(e=>e?b({...$e(Ee)},o):b()))))},Et=(e,t)=>{const o=document.createElement("canvas");o.width=e.width*t,o.height=e.height*t;const a=xt(o);a.imageSmoothingEnabled=!1,a.drawImage(e,0,0,o.width,o.height);return o.toDataURL()},$t=(e,t)=>{const o=document.createElement("canvas"),a=xt(o),n=e.width*t,s=e.height*t;o.width=3*n,o.height=2*s,a.fillStyle="white",a.fillRect(0,0,n,2*s),a.fillStyle="black",a.fillRect(n,0,2*n,2*s),a.fillStyle="gray",a.fillRect(2*n,0,3*n,2*s);const r=Math.ceil(n/8),i=Math.ceil(n/r),l=Math.ceil(2*s/r);a.fillStyle="darkgray";for(let p=0;p<l;p++)for(let e=0;e<i;e++)(e+p)%2==0&&a.fillRect(2*n+e*r,p*r,r,r);a.imageSmoothingEnabled=!1,a.drawImage(e,0,0,e.width,e.height,0,0,n,s),a.drawImage(e,0,0,e.width,e.height,n,0,n,s),a.drawImage(e,0,0,e.width,e.height,2*n,0,n,s);const c=Math.ceil(n/3),d=Math.ceil(n/c),u=Math.ceil(s/c);for(let p=0;p<3*u;p++)for(let t=0;t<3*d;t++)a.drawImage(e,0,0,e.width,e.height,t*c,s+p*c,c,c);return o.toDataURL()},xt=e=>{const t=e.getContext("2d");if(!t)throw new Error("ctx required");return t};function St(e,t,o,a,n){const s=document.createElement("canvas");return s.width=a,s.height=n,xt(s).drawImage(e,t,o,a,n,0,0,a,n),s}function Dt(e,t,o,a){xt(t).clearRect(o,a,e.width,e.height),xt(t).drawImage(e,o,a)}const Tt=()=>document.createElement("canvas"),Mt=async e=>new Promise((t=>{const o=new Image;o.onload=function(){t(o)},o.src=e})),Ot=(e,t)=>{xt(e).drawImage(t,0,0)},Pt=(e,t,o)=>{xt(o).clearRect(e,t,1,1)};function Rt(e,t,o,a){const n=xt(a);n.clearRect(e,t,1,1);const{red:s,green:r,blue:i}=V(o),l=K(s,r,i);n.fillStyle=l,n.fillRect(e,t,1,1)}function Bt(e,t=0,o=0,a,n){const s=xt(e),r=a||e.width,i=n||e.height,l=s.getImageData(t,o,r,i).data,c=[];for(let d=0;d<l.length;d+=4){const{red:e,green:t,blue:o,alpha:a}=Z(l,d),n=ee(e,t,o,a);c.push(n)}return c}const Ft=(e,t)=>{const{name:o,description:a,code:n}=e;return`\n# ${o}.\n\n[[THUMBNAIL]]\n\n${a||"No description provided."}\n\n[Click to import this asset](${t}) or copy/paste the Import section below to import manually.\n\n## Tiling Proof\n\n[[TILING]]\n\n## Code\n\n${n?`\`\`\`js\n${n}\n\`\`\``:"This asset contains no code."}\n\n## Import\n\n\`\`\`json\n${JSON.stringify(e,null,2)}\n\`\`\`\n\n`},Lt={},Nt=e=>{const t=O(!0),o=O(H),a=O(H),n=O(""),{assetEditor:s}=po,{sprite:r,name:i,asset:l}=s();return(async()=>{const e=await Mt(r.val);a.val=$t(e,10),o.val=Et(e,3),n.val=await Re(JSON.stringify(G(l()))),t.val=!1})().catch(console.error),P(a,o,n,i,t,((e,t,o,a,n)=>n?b("Processing..."):b({...$e("ShareTool")},qe({tabs:{Link:()=>b(I("Share your asset with your friends. Copy and paste "),kt({content:`Check out my WorldForge asset: ${a}!\n\n${o}`})),github:()=>b(I("The best way to share your assets is through the official github repo."),D("Step 1 - Open a new github issue"),I(A({href:"https://github.com/benallfree/awesome-worldforge/issues/new",class:"button",target:"_blank"},"go to github")),D("Step 2: Copy and paste this for the title"),kt({content:`[Asset Submission] ${a}`}),D("Step 3: Copy and paste this into the issue body"),kt({content:Ft(G(l()),o)}),D("Step 4: Copy and paste this into the issue body where the [[THUMBNAIL]] placeholder is."),x({src:t}),D("Step 5: Copy and paste this into the issue body where the [[TILING]] placeholder is."),x({src:e}))}}))))},Wt=e=>{const{closeModal:t}=po;return{title:()=>"ðŸ˜¾",onClick:t,selected:!1}},_t=e=>({title:()=>"ðŸ‘¯â€â™€ï¸",onClick:()=>{const{assetEditor:e,closeModal:t,openAssetEditor:o}=po,{asset:a}=e(),n=a(),s={...n,id:j(),name:`Clone of ${n.name}`};t().then((()=>o(s))).catch(console.error)},selected:!1}),Ut={},jt=e=>{const{closeModal:t,deleteAsset:o,assetEditor:a}=po,{id:n}=a();return{extraProps:{class:"danger"},title:()=>"ðŸ’€",onClick:()=>{de(n),t().then((()=>{o(n)}))},selected:!1}},Jt=e=>b({...$e("AssetEditor")},Xe({floating:!0,tools:[Wt(),_t(),jt({})]}),qe({tabs:{Canvas:()=>ht(),Meta:()=>It(),Code:()=>vt(),Share:()=>Nt()}}));function Ht(e){return ze(Bt(e)).filter((e=>e!==F)).map(te)}const zt=async e=>{const t=await Mt(e.sprite),o=O(e.sprite),a=O(e.spriteData),n=O(e.name),s=O(e.description),r=O(e.code),i=O(e.isBedrock),l=O(ct.Draw),c=O(L),d=O(0),u=O(0),p=O(!1),h=Tt();h.width=t.width,h.height=t.height,xt(h).clearRect(0,0,h.width,h.height),Ot(h,t);const m=O(!1),v=O(h),g=O([]),f=je(W*W).map((()=>O(F))),y=()=>a.val.animations.reduce(((e,t)=>Math.max(e,t.frameCount)),0),w=()=>{const e=a.val;e.highestFrameCount=y(),e.animations.forEach(((t,o)=>{if(!(t.frameCount>0)){if(o+1<e.animations.length){const e=0,t=(o+1)*W,a=h.width,n=h.height-t,s=xt(h).getImageData(e,t,a,n),r=0,i=o*W;xt(h).putImageData(s,r,i)}u.val>o&&u.val--}})),e.animations=e.animations.filter((e=>e.frameCount>0));{const t=e.highestFrameCount*W,a=e.animations.reduce(((e,t)=>e+(t.frameCount>0?1:0)),0)*W,n=xt(h).getImageData(0,0,h.width,h.height);h.width=t,h.height=a,xt(h).putImageData(n,0,0),o.val=h.toDataURL()}a.val={...e}},C=async()=>{const e=Ht(h).sort();JSON.stringify(g.val)!==JSON.stringify(e)&&(g.val=e),Bt(h,d.val*W,u.val*W,W,W).forEach(((e,t)=>{f[t].val!==e&&(f[t].val=e)}))};C();const b=(e=d.val,t=u.val)=>St(h,e*W,t*W,W,W),A=(e,t=d.val,a=u.val)=>{Dt(e,h,t*W,a*W),o.val=h.toDataURL()};return{asset:()=>({id:e.id,name:n.val,description:s.val,code:r.val,isBedrock:i.val,sprite:o.val,spriteData:a.val}),setSelectedColor:e=>{c.val=e,l.val=ct.Draw},setPixel(e,t){const a=d.val*W+e,n=u.val*W+t;l.val===ct.Erase?Pt(a,n,h):Rt(a,n,c.val,h);const s=Ht(h);g.val.length!==s.length&&(g.val=s),o.val=h.toDataURL(),f[t*W+e].val=l.val===ct.Erase?F:oe(c.val,255)},setTool(e){l.val=e},addAnimation(){a.val.animations.push({reverseLoop:!1,frameCount:1}),a.val={...a.val},w(),A(b(d.val,u.val),0,a.val.animations.length-1),u.val=a.val.animations.length-1,d.val=0,C()},selectAnimationFrame(e,t){d.val=e,u.val=t,C()},togglePlay(){m.val=!m.val},addFrame(e){const t=b();a.val.animations[e].frameCount++,y(),a.val={...a.val},w(),d.val=a.val.animations[e].frameCount-1,u.val=e,A(t),C()},removeFrame(e){xt(h).clearRect((a.val.animations[e].frameCount-1)*W,e*W,W,W),a.val.animations[e].frameCount--,y(),a.val={...a.val},w(),u.val=Math.min(u.val,a.val.animations.length-1),d.val=Math.min(d.val,a.val.animations[u.val].frameCount-1),C()},copy(){v.val=b(d.val,u.val),p.val=!0},paste(){A(v.val,d.val,u.val),C()},toggleReverseLoop(t){a.val.animations[t].reverseLoop=!e.spriteData.animations[t].reverseLoop,a.val={...a.val}},setCode(e){r.val=e},description:s,setDescription(e){s.val=e},name:n,setName(e){n.val=e},isBedrock:R(i),setIsBedrock(e){i.val=e},spriteData:R(a),code:R(r),tool:R(l),color:R(c),rgbHexPixels:f.map(R),palette:R(g),sprite:R(o),xOffset:R(d),yOffset:R(u),isPlaying:R(m),hasCopy:R(p),id:e.id,canvas:h}},Gt=()=>_();function Xt(e,t){const o=t.pageX,a=t.pageY,n=e.offsetWidth,s=e.offsetHeight,r=window.innerWidth-n,i=window.innerHeight-s;let l=o,c=a;l>r&&(l=r),c>i&&(c=i),e.style.left=l+"px",e.style.top=c+"px",e.style.transform="none"}const Yt=()=>{const e=Gt(),t=O(!1),o=O({title:()=>"New Modal",body:()=>b("Empty modal body")});t.onnew((t=>{setTimeout((()=>{const{event:a}=o.val;if(!t||!a)return;const n=document.getElementById(e);de(n),Xt(n,a)}),0)}));const a=async()=>{var e,a;t.val=!1,await Be(),null==(a=(e=o.val).onClosed)||a.call(e),await Be()};return[()=>P(t,o,((t,o)=>{if(!t)return b();const{title:n,event:s,body:r,onClickAway:i,onCloseClicked:l}=o;return b({...$e(s?"":["modal-overlay",ye]),...xe((()=>{null==i||i(),a().catch(console.error)}),{targetOnly:!0})},b({id:e,...$e("Modal")},b({...$e("title",ye)},n()),b({...$e("close",we),...xe((()=>{null==l||l(),a().catch(console.error)}))},"âŒ"),b({...$e("body")},r())))})),async e=>{o.val={...e},t.val=!0,await Be()},a,t]},qt="__worldforge__",Qt=e=>{if(!e)return null;try{return JSON.parse(e)}catch{}return null},Vt=()=>{const e=Qt(localStorage.getItem(qt));return{splash:!1,worlds:{},..."object"==typeof e?e:{}}},Kt=e=>localStorage.setItem(qt,JSON.stringify(e)),Zt=(e,t)=>{const o=Vt();return void 0===o[e]?t:o[e]},eo=(e,t)=>{const o=Vt();o[e]=t,Kt(o)},to=()=>Zt("currentWorldId",void 0),oo=e=>eo("currentWorldId",e),ao=e=>Zt("worlds",{})[e],no=e=>{const t=Zt("worlds",{});t[e.id]=e,eo("worlds",t)},so=()=>_(),ro=e=>e,io=()=>{const e=to();if(!e)return;return ao(e)},lo=e=>e;so(),lo("New World");const co=e=>({assets:e.assets.map((e=>e))}),uo=()=>{const e=O(!1),t=O(!1),o=O(so()),a=ce,n=O(lo("New World")),s={},r=O([]),i={};let l;je(a).forEach((e=>{je(a).forEach((t=>{const o=ie(e,t);i[o]=O({assets:[]})}))}));const c=()=>{no(u()),oo(o.val)},d=io();d&&(o.val=d.id,n.val=d.name,Le(d.assets).forEach((([e,t])=>{try{const o=X(t),a=O(o);s[U(e)]=a}catch(o){}})),r.val=ve(s),Le(d.cells).forEach((([e,t])=>{try{const o=q(t),a=O(o);i[Y(e)]=a}catch(o){}}))),e.val=!0;const u=()=>({id:o.val,name:n.val,assets:Object.values(s).reduce(((e,t,o)=>{const a=G(t.val);return e[a.id]=a,e}),{}),cells:Object.entries(i).reduce(((e,[t,o])=>{const a=co(o.val);return e[ro(t)]=a,e}),{})}),[p,h,m,v]=Yt(),g=O(void 0),f={createAsset:async()=>z(),deleteAsset:async e=>{delete s[e],Object.entries(i).map((([t,o])=>{o.val={...o,assets:o.val.assets.filter((t=>t.assetId!==e))}})),r.val=ve(s),c()},openAssetEditor:async e=>{const t=X(G(e));l=await zt(t);const{name:o}=l,a=()=>{de(l),f.saveAsset(l.asset())};h({title:()=>P(o,(e=>`Asset Editor: ${e}`)),body:()=>Jt(),onCloseClicked:a,onClickAway:a,onClosed:()=>{l=void 0}})},saveAsset:e=>{s[e.id]||(s[e.id]=O(e)),s[e.id].val=e,r.val=ze([...r.val,e.id]),c()},assetEditor:()=>(de(l),l),worldId:o,loaded:e,size:a,name:n,assets:s,assetIds:r,serializeWorld:()=>JSON.stringify(u()),worldAtRest:u,openModal:h,closeModal:m,modal:p,isModalOpen:v,activeAssetId:g,setActiveAssetId:e=>g.val=e,addAssetToTerrainCell:(e,t,o)=>{const a=ie(e,t);i[a]||(i[a]=O({assets:[]}));const n=i[a].val,r=[...n.assets,{assetId:o}].reverse(),l=[r.find((e=>s[e.assetId].val.isBedrock)),r.find((e=>!s[e.assetId].val.isBedrock))].filter((e=>!!e));i[a].val={...n,assets:l},c()},cells:i,imported:t};return f},po=uo(),ho=15,mo=11282,vo={build:ho,bytes:mo},go=e=>{const{asset:t,active:o,onClick:a}=e,{openAssetEditor:n}=po,{name:s}=t;return b({...$e("AssetBarItem",Ce)},o?b({...$e("active",ye,Ie)}):b(),b({...$e(Ce)},b({...$e("title")},s),b({...xe(a)},st({asset:t})),b({...$e("controls")},C({...xe((()=>{n(t).catch(console.error)}))},"edit"))))},fo=()=>{const{activeAssetId:e,assetIds:t,assets:o,createAsset:a,openAssetEditor:n,setActiveAssetId:s,closeModal:r}=po;return P(t,e,((e,t)=>{const i=e.map((e=>{const a=o[e];return de(a.val),P(a,(e=>{const{id:o}=e;return go({asset:e,active:t===o,onClick:()=>{t===o?s(void 0):(r(),s(o))}})}))}));return b({...$e("AssetBar")},...i,C({...xe((()=>{a().then(n).catch(console.error)}))},"+"))}))},yo=e=>{const{asset:t,onclick:o}={onclick:()=>{},...e};return P(t,(e=>{const{id:t,sprite:a}=e;return x({...$e("Sprite",fe),src:a,...xe(o)})}))},wo={onFinished:()=>de(!1)},Co=e=>{const{onFinished:t}={...wo,...e},{openModal:o,saveAsset:a,assets:n,assetIds:s}=po,r=()=>{setTimeout(t)},i=_e();return i?(async()=>{try{const e=await Pe(i);if(!e)throw new Error("Import payload could not be unpacked.");const t=JSON.parse(e);if(!J(t))throw new Error("Import object not recognized.");const s=await X(t),l=!!n[s.id];o({title:()=>`Import Asset: ${s.name}`,body:()=>b(l?T("Import and overwrite?"):b(),yo({asset:s}),b(C({...$e(l?ke:""),...xe((()=>{a(s),r()}))},"Import")))})}catch(e){o({title:()=>"Import error",body:()=>I(`${e}`),onClosed:r})}})():r(),D("Importing...")},bo=()=>{const{worldId:e,name:t,serializeWorld:o}=po,a=O("");Re(o()).then((o=>{const n=t.val,s=e.val;a.val=`Hey, check out my WorldForge map!\n\nMap name: ${n}\nWorld ID: ${s}\n\n${o}\n\nNote: If the link doesn't work, just copy this whole message into the WorldForge share tool and click Import.`})).catch(console.error);const{openModal:n}=po;return C({class:"ShareToolButton",...xe((()=>n({title:()=>"Share a World",body:()=>b({class:"ShareTool"},P(a,(e=>kt({content:e,success:"DLC copied to clipboard! Share on messaging apps!",instructions:"Copy your DLC below and share it over text, Discord, WhatsApp, Twitter, or anywhere else you want!"}))))})))},b("â¤´ï¸",E(),"share"))},Ao=e=>{const{activeAssetId:t,addAssetToTerrainCell:o,openModal:a,closeModal:n,cells:s,assets:r}=po,i=O(!1),{x:l,y:c}=e,d=ie(l,c),u=e=>{("mousedown"===e.type||e.buttons)&&(t.val?o(l,c,t.val):(t.val=void 0,n().then((()=>{a({title:()=>`Asset Editor ${l}x${c}`,event:e,onClosed:()=>{i.val=!1},body:()=>b("asset editor")}).catch(console.error),i.val=!0})).catch(console.error)))};return b({...$e("TerrainCell",fe,we,Ce),...De(u),...Se(u)},b({...$e(ye,"border-hint")}),P(s[d],(e=>e?b({...$e(ye,"content-container")},...e.assets.map((e=>{const t=r[e.assetId];return P(t,(e=>st({asset:e,extraClasses:[ye],isAnimating:!0})))}))):b())),P(i,(e=>e?b({...$e("active",ye,Ie)}):b())))},Io=()=>{const{size:e}=po;return b({...$e("TerrainMap",be)},b({...$e("grid",Ae,be),style:`width: ${Ne(le*e)}`},...je(e).map(((t,o)=>je(e).map(((e,t)=>Ao({x:ae(o),y:ne(t)})))))),bo())},ko=()=>{const{imported:e}=po;return b(P(e,(t=>t?b(fo(),Io()):Co({onFinished:()=>{e.val=!0,Ue()&&setTimeout((()=>{location.href=location.origin}))}}))))},Eo=()=>{const{loaded:e,modal:t}=po;return b({...$e("App",be)},P(e,(e=>e?ko():D("WorldForge"))),b({...$e("footer")},A({href:"https://github.com/benallfree/worldforge"},"WorldForge"),` build ${vo.build}. Created with love under the MIT open source license. `),t())};w.add(document.getElementById("app"),Eo());
